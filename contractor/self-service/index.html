<template>
    <div class="small-12 medium-8 large-6 columns small-centered">
        <div class="row is-hidden" id="service_error_container">
            <div class="callout alert">
                <center>
                    <div class="red">
                        <div class="top-padding">
                            <i class="fa ${errorOptions.icon} fa-2x" aria-hidden="true"></i>
                            <p class="lead">${errorOptions.header}</p>
                        </div>
                    </div>
                    <div>
                        <p>${errorOptions.msg}</p>
                        <a class="button primary radius" data-close aria-label="Close modal" type="button" click.delegate="pageRefresh()">
                            <span aria-hidden="true">Ok</span>
                        </a>
                    </div>
                </center>
            </div>
        </div>
        <div class="row">
            <div id="userInfo" class="columns small-11 small-offset-1">
                <div class="columns"><span class="page-title">${userName}</span> (${userId})</div>
            </div>
        </div>
        <div class="row">
            <ul class="accordion" data-accordion data-allow-all-closed="true">
                <li id="accordItemPwdReset" class="accordion-item is-hidden" data-accordion-item>
                    <a href="#" class="accordion-title">Reset my password</a>
                    <div class="accordion-content" data-tab-content>
                        <div if.bind="!passwordHasBeenReset">
                            <form data-abide id="newPasswordForm">
                                <div class="row">
                                    <div class="small-12 medium-6 columns" validation-errors.bind="passwordErrors"
                                         class.bind="passwordErrors.length ? 'has-error' : ''">
                                        <label for="newPasswordValue">Password</label>
                                        <input type="password" id="newPasswordInput"
                                               placeholder="********"
                                               value.bind="user.newPasswordValue & validate"
                                               aria-describedby="new_password_help_text"
                                               keyup.delegate="passwordMeterListener()">
                                        <span class="form-error is-visible" repeat.for="errorInfo of passwordErrors">
                                            ${errorInfo.error.message}
                                        </span>
                                    </div>
                                </div>
                                <div class="row margin-bottom">
                                    <div class="small-12 medium-5 columns margin-bottom" id="passwordStrengthMeter">
                                        <div class="small-3 medium-3 column ${meterColorClass}" id="meterFirstQuarter"> </div>
                                        <div class="small-3 medium-3 column ${passwordStrengthScore >= 2 ? meterColorClass : ''}" id="meterSecondQuarter"> </div>
                                        <div class="small-3 medium-3 column ${passwordStrengthScore >= 3 ? meterColorClass : ''}" id="meterThirdQuarter"> </div>
                                        <div class="small-3 medium-3 column ${passwordStrengthScore >= 4 ? meterColorClass : ''}" id="meterFourthQuarter"> </div>
                                    </div>
                                </div>
                                <div class="row columns">
                                    <p class="help-text" id="newPasswordHelpText">Your password must contain any three from the following list: Upper or Lower case letter, numbers, and special characters. You will not be able to change your password if it does not meet these requirements.</p>
                                </div>
                                <div class="row">
                                    <div class="small-12 medium-6 columns">
                                        <strong>Confirm New Password</strong>
                                        <input id="confirmNewPasswordInput"
                                               value.bind="confirmPasswordValue"
                                               type="password"
                                               name="newPassword"
                                               placeholder="Enter New Password Again"
                                               aria-describedby="Enter New Password Again to Confirm"
                                               data-equalto="newPasswordInput"
                                               keyup.delegate="passwordMeterListener()">
                                        <span class="form-error">
                                            New Password Fields do not match.
                                        </span>
                                    </div>
                                </div>
                            </form>
                            <button class="button radius"
                                    disabled.bind="passwordResetDisabled"
                                    click.trigger="resetPassword()">
                                Submit
                            </button>
                        </div>
                        <div if.bind="passwordHasBeenReset">Your password has been successfully reset!</div>
                    </div>
                </li>
                <li id="accordItemAccountUnlock" class="accordion-item is-hidden" data-accordion-item data-allow-all-closed="true">
                    <a href="#" class="accordion-title">Unlock my account</a>
                    <div class="accordion-content" data-tab-content>
                        <div if.bind="!isUnlocked" id="pwdUnlock">
                            <p>If you know your password, but your account has become locked for some reason, you can unlock it below.</p>
                            <button class="button radius"
                                    click.delegate="unlockPassword()">
                                Unlock My Account Now
                            </button>
                        </div>
                        <div if.bind="isUnlocked" id="pwdUnlock">
                            <p>Congratulations, your account has been unlocked.</p>
                        </div>
                    </div>
                </li>
                <li id="accordItemChannelManagement" data-abide class="accordion-item" data-accordion-item data-allow-all-closed="true">
                    <a href="#" class="accordion-title">Edit my profile</a>
                    <div class="accordion-content" data-tab-content>
                        <!--Questions and Answers Area-->
                        <div class="row">
                            <div class="columns small-12">
                                <span class="section-title">Security Questions</span>
                            </div>
                            <div class="columns small-12">
                                <div if.bind="userQuestionList.length >= 5">
                                    <span class="form-error is-visible">
                                        You have completed enrollment of your security questions.
                                    </span>
                                </div>
                                <div if.bind="userQuestionList.length > 0">
                                    <table>
                                        <tr repeat.for="userQuestion of userQuestionList" change.delegate="setUpDdl()">
                                            <td>
                                                <div>
                                                    ${userQuestion.challengeQuestionText}
                                                </div>
                                            </td>
                                            <td>
                                                <div>
                                                    <a href="#" class="button small alert radius float-right"
                                                       click.delegate="removeQuestion(userQuestion)">Remove</a>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div if.bind="availQuestionList.length > 0">
                                    <div if.bind="userQuestionList.length < 5">
                                        <span class="form-error is-visible">
                                            You must have at least 5 security questions answered in your profile!
                                        </span>

                                        <b>Answer a new security question:</b>
                                        <div>
                                            <select value.bind="selectedQuestion"
                                                    matcher.bind="questionMatcher"
                                                    focus.bind="questionSelectFocus">
                                                <option model.bind="null"
                                                        value="">
                                                    -Choose Question-
                                                </option>
                                                <option repeat.for="userQuestion of availQuestionList"
                                                        model.bind="userQuestion">
                                                    ${userQuestion.challengeQuestionText}
                                                </option>
                                            </select>
                                            
                                            <div validation-errors.bind="selectedQuestionAnswerErrors"
                                                 class.bind="selectedQuestionAnswerErrors.length ? 'has-error' : ''">
                                                <label for="selectedQuestionAnswer">Answer to the selected question:</label>
                                                <input type="text"
                                                       placeholder="Enter your answer."
                                                       value.bind="user.selectedQuestionAnswer & validate" aria-describedby="Enter your answer here." keyup.delegate="addQuestionListener($event)">
                                                <span class="form-error is-visible" repeat.for="errorInfo of selectedQuestionAnswerErrors">
                                                    ${errorInfo.error.message}
                                                </span>
                                            </div>
                                            <button class="button radius"
                                                    disabled.bind="addQuestionDisabled"
                                                    click.trigger="addQuestion()">
                                                Save Answer
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!--Phone Number Area-->
                        <div class="row">
                            <div class="columns small-12">
                                <br /><span class="section-title">Phone Numbers</span>
                            </div>
                            <div class="columns small-12">
                                <table>
                                    <tbody>
                                        <tr repeat.for="smsNumber of user.channelList" if.bind="smsNumber.type == 'phone'">
                                            <td>
                                                <!--Phone Display-->
                                                <div class="columns small-12" if.bind="smsNumber.verified">
                                                    ${smsNumber.contactInfo}
                                                    <a class="button small alert radius float-right" if.bind="!smsNumber.confirmDelete" type="button" click.delegate="confirmDelete(smsNumber)">Remove</a>
                                                </div>
                                                <div class="row" if.bind="smsNumber.confirmDelete">
                                                    <div class="columns small-12">
                                                        <div class="callout alert">
                                                            <div class="columns small-12 text-center">
                                                                Are you sure you want to delete?
                                                            </div>
                                                            <div class="row">
                                                                <div class="column small-6 text-right"><a class="button small alert radius" click.delegate="RemoveContactInfo(smsNumber)">Yes</a></div>
                                                                <div class="column small-6 text-left"><a class="button small radius" click.delegate="confirmDelete(smsNumber)">No</a></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--Phone New Input-->
                                                <div class="row" if.bind="!smsNumber.verified">
                                                    <div class="columns small-12">
                                                        <div class="columns small-12 medium-6">
                                                            <div class="form-group" validation-errors.bind="smsNumberErrors"
                                                                 class.bind="smsNumberErrors.length ? 'has-error' : ''">
                                                                <input type="text"
                                                                       keyup.delegate="formatPhoneOnkeyup($event,smsNumber)"
                                                                       value.bind="smsNumber.contactInfo & validate"
                                                                       readonly.bind="smsNumber.channelIsReadOnly"
                                                                       focus.bind="smsNumber.channelInputFocus"
                                                                       placeholder="###-###-####"
                                                                       aria-describedby="newNumberInputHelpText" />
                                                                <span class="form-error is-visible" repeat.for="errorInfo of smsNumberErrors">
                                                                    ${errorInfo.error.message}
                                                                </span>
                                                                <p class="help-text"
                                                                   id="newNumberInputHelpText">Please enter a 10 digit phone number you regularly get text messages on.</p>
                                                            </div>
                                                        </div>
                                                        <div class="columns small-12 medium-6" if.bind="!smsNumber.hasActiveToken">
                                                            <div class="small button-group float-right">
                                                                <button class="button small radius"
                                                                        disabled.bind="smsNumberErrors.length > 0"
                                                                        click.trigger="verify(smsNumber)">
                                                                    Confirm
                                                                </button>
                                                                <button class="button small alert radius"
                                                                        click.delegate="RemoveContactInfo(smsNumber)">
                                                                    Remove
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--Phone Verify-->
                                                <div class="row" if.bind="!smsNumber.verified && smsNumber.hasActiveToken">
                                                    <div class="columns small-12">
                                                        <div class="callout alert">
                                                            <center>
                                                                <p><strong>Enter verification code we've sent to your phone.</strong><br /><h5>${smsNumber.contactInfo}</h5></p>
                                                                <p>The code is valid for the next <br /><b><span id="smsCounter${$index}">&lt;timer goes here&gt;</span></b> mins.</p>
                                                            </center>
                                                        </div>
                                                        <input value.bind="smsNumber.token"
                                                               keyup.delegate="onEnterVerifyToken($event,smsNumber)"
                                                               focus.bind="smsNumber.channelTokenFocus"
                                                               type="text"
                                                               placeholder="Enter code here"
                                                               pattern="number">
                                                        <span class="is-hidden form-error">
                                                            Incorrect code. Please try again.
                                                        </span>
                                                        <a href="#"
                                                           class="expanded primary button radius"
                                                           click.delegate="verify(smsNumber)">Verify Code</a>
                                                        <a href="#"
                                                           class="expanded alert button radius"
                                                           click.delegate="cancel($event,smsNumber)">Cancel Code</a>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!--Phone Add New-->
                            <div class="small-12 columns">
                                <a href="#"
                                   class="button radius"
                                   focus.bind="addPhoneButtonFocus"
                                   click.delegate="addNewChannel('phone')">Add Number</a>
                            </div>
                        </div>
                        <!--Email Address Area-->
                        <div class="row">
                            <div class="columns small-12">
                                <br /><span class="section-title">Email Addresses</span>
                            </div>
                            <div class="columns small-12">
                                <table>
                                    <tbody>
                                        <tr repeat.for="userEmail of user.channelList" if.bind="userEmail.type == 'email'">
                                            <td>
                                                <!--Email Display-->
                                                <div class="columns small-12" if.bind="userEmail.verified">
                                                    ${userEmail.contactInfo}
                                                    <button class="button small alert radius float-right"
                                                            if.bind="!userEmail.confirmDelete"
                                                            click.delegate="confirmDelete(userEmail)">
                                                        Remove
                                                    </button>
                                                </div>
                                                <div class="row" if.bind="userEmail.confirmDelete">
                                                    <div class="columns small-12">
                                                        <div class="callout alert">
                                                            <div class="columns small-12 text-center">
                                                                Are you sure you want to delete?
                                                            </div>
                                                            <div class="row">
                                                                <div class="column small-6 text-right"><a href="#" class="button small alert radius" click.delegate="RemoveContactInfo(userEmail)">Yes</a></div>
                                                                <div class="column small-6 text-left"><a href="#" class="button small radius" click.delegate="confirmDelete(userEmail)">No</a></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--Email New Input-->
                                                <div class="row" if.bind="!userEmail.verified">
                                                    <div class="columns small-12">
                                                        <div class="columns small-12 medium-6">
                                                            <div class="form-group" validation-errors.bind="userEmailErrors"
                                                                 class.bind="userEmailErrors.length ? 'has-error' : ''">
                                                                <input id="newChannelInput"
                                                                       type="text"
                                                                       placeholder="name@domain.com"
                                                                       value.bind="userEmail.contactInfo & validate"
                                                                       focus.bind="userEmail.channelInputFocus"
                                                                       readonly.bind="userEmail.channelIsReadOnly"
                                                                       keyup.delegate="onEnterSubmitEmail($event,userEmail)"
                                                                       aria-describedby="newEmailInputHelpText" />
                                                                <span class="form-error is-visible" repeat.for="errorInfo of userEmailErrors">
                                                                    ${errorInfo.error.message}
                                                                </span>
                                                            </div>
                                                            <p class="help-text" id="newEmailInputHelpText">This should be something other than your AEP.com account. Preferrably one you can access from your mobile phone or at home.</p>
                                                        </div>
                                                        <div class="columns small-12 medium-6" if.bind="!userEmail.hasActiveToken">
                                                            <div class="small button-group float-right">
                                                                <button class="button small alert radius float-right"
                                                                        click.delegate="RemoveContactInfo(userEmail)">
                                                                    Remove
                                                                </button>
                                                                <button class="button small radius float-right"
                                                                        disabled.bind="userEmailErrors.length > 0"
                                                                        click.trigger="verify(userEmail)">
                                                                    Confirm
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--Email Verify-->
                                                <div class="row" if.bind="!userEmail.verified && userEmail.hasActiveToken">
                                                    <div class="columns small-12">
                                                        <div class="callout alert">
                                                            <center>
                                                                <p><strong>Enter verification code we've sent to your inbox.</strong><br /><h5>${userEmail.contactInfo}</h5></p>
                                                                <p>The code is valid for the next <br /><b><span id="emailCounter${$index}">&lt;timer goes here&gt;</span></b> mins.</p>
                                                            </center>
                                                        </div>
                                                        <input value.bind="userEmail.token"
                                                               keyup.delegate="onEnterVerifyToken($event,userEmail)"
                                                               focus.bind="userEmail.channelTokenFocus"
                                                               type="text"
                                                               placeholder="Enter code here"
                                                               pattern="number">
                                                        <span class="is-hidden form-error">
                                                            Incorrect code. Please try again.
                                                        </span>
                                                        <button class="expanded primary button radius"
                                                                click.delegate="verify(userEmail)">
                                                            Verify Code
                                                        </button>
                                                        <a href="#" class="expanded alert button radius"
                                                           keypress.delegate="cancel($event,userEmail)"
                                                           click.delegate="cancel($event,userEmail)">Cancel Code</a>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!--Email Add New-->
                            <div class="columns small-12">
                                <button class="button radius"
                                        focus.bind="addEmailButtonFocus"
                                        click.delegate="addNewChannel('email')">
                                    Add Email
                                </button>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</template>
